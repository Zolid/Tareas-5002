<!DOCTYPE html>
<html>
	<head>
		<title>Concurso de Fotografía</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<link rel="stylesheet" type="text/css" href="styles.css">
		<style>
			#map {
				height: 400px;
				width: 100%;
			}
		</style>
	</head>
	<body>


		<form style="display: inline" action="concursante.php" method="get">
 			 <button>Inscripciones</button>
		</form>


		<form style="display: inline" action="listado.php" method="get">
  			<button>Listado de Participantes</button>
		</form>

		<form style="display: inline" action="galeria.php" method="get">
  			<button>Listado de Fotografías</button>
		</form>
		<br>
		<br>
		<br>
		<div id="map"></div>
		<script>
			var xmthttp;
		 	var map;
		 	var geocoder;
		 	var comunas;
      var infoWindows = [];
      var markers = [];
      var ltd = [];
      var lng = [];
      		function initMap() {
        		var uluru = {lat: -33.441258, lng: -70.688694};
        		map = new google.maps.Map(document.getElementById('map'), {
          			zoom: 4,
          			center: uluru,
                mapTypeId: google.maps.MapTypeId.ROADMAP  
        		});
        		geocoder = new google.maps.Geocoder();
        		codeAddress();
      		}

      		function getComunas() {
      			if (window.XMLHttpRequest) {
					xmlhttp = new XMLHttpRequest();
				} else {
					xmlhttp = new ActiveXObject("Microsoft.XMLHTTP")
				}
				xmlhttp.onreadystatechange = function() {
					if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
						comunas = JSON.parse(xmlhttp.responseText);
					}
				}
				xmlhttp.open("GET", "getComunas.php", false);
				xmlhttp.send();
      		}

      		function codeAddress() {
      			getComunas();
      			var datos = [];
      			for (var i in comunas) {
      				datos.push([i, comunas[i]])
      			}
           
            var pais = " , Chile";
            for (var i in datos) {
              var ubicacion = datos[i][0];
              ubicacion += pais;
              geocoder.geocode({'address': ubicacion}, function(results, status){
                ltd.push(results[0].geometry.location.lat());
                lng.push(results[0].geometry.location.lng());
                if (status === 'OK') {
                  var marker = new google.maps.Marker({
                    map: map,
                    position: results[0].geometry.location,
                    animation : google.maps.Animation.DROP,
                    infoWindowIndex : i
                  });
                  var contenido;
                  for (var j in datos[i][1]) {
                    contenido += '<strong>'+datos[i][1][j]+'</strong><br>';
                  }
                  var infoWindow = new google.maps.InfoWindow({
                    content : contenido
                  });

                  google.maps.event.addListener(marker, 'click', function(event){
                    infoWindow.open(map, this);
                  });

                  infoWindows.push(infoWindow);
                  markers.push(marker);

                }
              });
            }
            console.log(ltd);
            console.log(lng);
            
        }
      		
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBX6vNMxe_-YEBCKxDZ2s2xsi3Rii3W4fQ&callback=initMap">
    </script>	
	</body>
</html>